========================class 8=====================================

stateful container : Data will be there permanently

stateless container : Data will be deleted after container deletion

example: In our Spring Boot MySQL docker compose app , we used MySQL as docker container to store data and when we stop/deleted the containers and re created these containers we lost the data.
To store application data permanently in this case we may have to make docker container as stateful and hence docker volume concept.

Docker Volume
==============
Volumes are used to persist data  which is generated by docker container and to avoid data loss

With the help of docker volumes we can make our containers stateful

$ docker volume ls ==> display docker volumes available 

$ docker volume create telusko-vol  ==> Create new volume by name telusko-vol

$ docker volume rm telusko-vol ==> remove docker volume by name telusko-vol

$ docker volume inspect telusko-vol ==> Inspect our docker volume


==> Create mount directory in host machine ( /home/ece2-user/)

$ mkdir app

Mapped this app directory in docker-compose.yml file

vi docker-compose.yml
version: "3.8"

services:
  mysqldb:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=sbm
    volumes:
      - .app:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - springboot-db-net

  application:
    build: .
    depends_on:
      - mysqldb   # âœ… fixed
    ports:
      - "8080:8080"
    networks:
      - springboot-db-net
    volumes:
      - /data/springboot-app

networks:
  springboot-db-net:

start and stop restart docker-compose to check if data is persistence even after deleting and re creating containers 

======================================================================================================================

Docker Swarm
=============

==> It is a Orchestration platform  (Managing the process (containers)).

==> Docker swarm is used to setup docker cluster ==> cluster here referring to group of servers(machines).

==> It is a way to run and manage many docker containers across multiple machines and it will handle where to run each container, load balancing traffic across them and keeping everything in sync

==> Here we define a service ( eg app) and Swarm manages its containers and we can easily also scale up/down the number of containers.


Docker Swarm Cluster Setup
===========================

==> Create 3/4 EC2 instances (ubuntu) and install docker in all 3 of these machines 

==> For Swarm Cluster Communications enable 2377 port in the security group

1 => Master Node
2/3 => Worker Node

Get connected to these EC2 VM and install docker

curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

Check docker version

$ docker --version

Get Connected to Master Node

$ sudo docker swarm init --advertise-addr <private-ip-masternode>

Swarm initialized: current node (h0kzjs3zeoa2crn58vnaqir2i) is now a manager.

==> To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

$ docker swarm join-token manager

Use below command in all worker nodes
(To add a worker to this swarm, run the below command)

$ sudo docker swarm join --token SWMTKN-1-2f3x7nda7zufmdlut0dy9ff0cen8cl0u2muh9eeq0rbmdh20px-5h9yko4ql8k1zvkk7runx7rhy 172.31.45.185:2377









